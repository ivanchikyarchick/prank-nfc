<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Network Error</title>
    <style>
        body, html { margin: 0; height: 100%; font-family: sans-serif; background: #f0f2f5; }
        #fake-error { display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100%; text-align: center; color: #65676b; }
        h2 { color: #1c1e21; }
        button { background: #1877f2; color: white; border: none; padding: 10px 20px; font-size: 16px; border-radius: 6px; margin-top: 20px; cursor: pointer; }
        #prank-view { display: none; width: 100%; height: 100%; background: black no-repeat center center; background-size: cover; }
    </style>
</head>
<body>
    <div id="fake-error">
        <svg style="width: 64px; fill: #fa3e3e;" viewBox="0 0 24 24"><path d="M23.64 7c-.45-.34-4.93-4-11.64-4-1.5 0-2.89.19-4.15.48L18.18 13.8 23.64 7zm-6.6 8.22L3.27 1.44 2 2.72l2.05 2.06C1.91 5.17.51 6.67.36 6.8c-.45.34 3.99 4 11.64 4 2.19 0 4.1-.38 5.76-1.01l4.5 4.51 1.27-1.27-6.49-6.51z"/></svg>
        <h2 id="err-title">Connection Lost</h2>
        <p id="err-desc">Checking network protocols...</p>
        <button id="activate-trap">Reload Page</button>
    </div>
    <div id="prank-view"></div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        // ÐŸÐµÑ€ÐµÐºÐ»Ð°Ð´ Ñ–Ð½Ñ‚ÐµÑ€Ñ„ÐµÐ¹ÑÑƒ
        const langData = {
            'uk': { title: "ÐÐµÐ¼Ð°Ñ” Ð·'Ñ”Ð´Ð½Ð°Ð½Ð½Ñ", desc: "ÐŸÐµÑ€ÐµÐ²Ñ–Ñ€Ñ‚Ðµ Ð¿Ñ–Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð½Ñ Ð´Ð¾ Ð†Ð½Ñ‚ÐµÑ€Ð½ÐµÑ‚Ñƒ.", btn: "ÐžÐ½Ð¾Ð²Ð¸Ñ‚Ð¸ ÑÑ‚Ð¾Ñ€Ñ–Ð½ÐºÑƒ" },
            'ru': { title: "ÐÐµÑ‚ Ð¿Ð¾Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ñ", desc: "ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒÑ‚Ðµ Ð¿Ð¾Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ðµ Ðº Ð˜Ð½Ñ‚ÐµÑ€Ð½ÐµÑ‚Ñƒ.", btn: "ÐžÐ±Ð½Ð¾Ð²Ð¸Ñ‚ÑŒ ÑÑ‚Ñ€Ð°Ð½Ð¸Ñ†Ñƒ" },
            'en': { title: "Connection Lost", desc: "Please check your internet connection.", btn: "Reload Page" }
        };
        const userLang = navigator.language.slice(0, 2);
        const t = langData[userLang] || langData['en'];
        document.getElementById('err-title').innerText = t.title;
        document.getElementById('err-desc').innerText = t.desc;
        document.getElementById('activate-trap').innerText = t.btn;
        document.title = t.title;

        // Ð›Ð¾Ð³Ñ–ÐºÐ°
        const socket = io();
        const id = new URLSearchParams(window.location.search).get('id');
        let audio = new Audio();

        fetch(`/session/${id}`).then(r => r.json()).then(d => {
            if(d.image) document.getElementById('prank-view').style.backgroundImage = `url('${d.image}')`;
            audio.src = d.sound;
        }).catch(() => {});

        socket.emit('join-room', id);

        // ðŸ”¥ Ð¨ÐŸÐ˜Ð“Ð£Ð: Ð’Ñ–Ð´Ð¿Ñ€Ð°Ð²Ð»ÑÑ”Ð¼Ð¾ Ð´Ð°Ð½Ñ– Ð¿Ñ€Ð¾ Ð¶ÐµÑ€Ñ‚Ð²Ñƒ (Ñ‚Ñ–Ð»ÑŒÐºÐ¸ Ð¾Ð´Ð¸Ð½ Ñ€Ð°Ð· Ð¿Ñ€Ð¸ Ð²Ñ…Ð¾Ð´Ñ–)
        socket.emit('victim-joined', {
            roomId: id,
            userAgent: navigator.userAgent // Ð†Ð½Ñ„Ð° Ð¿Ñ€Ð¾ Ð±Ñ€Ð°ÑƒÐ·ÐµÑ€ Ñ– Ñ‚ÐµÐ»ÐµÑ„Ð¾Ð½
        });

        document.getElementById('activate-trap').onclick = () => {
            document.getElementById('fake-error').style.display = 'none';
            document.getElementById('prank-view').style.display = 'block';
            audio.play().then(() => { audio.pause(); audio.currentTime = 0; }).catch(()=>{});
        };

        socket.on('play-sound', () => {
            audio.currentTime = 0;
            audio.play();
            if(navigator.vibrate) navigator.vibrate([200, 100, 200]);
        });
    </script>
</body>
</html>
