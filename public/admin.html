<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SPY CONTROL v9.8 MULTI</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --neon: #00f2ff;
            --neon-glow: rgba(0, 242, 255, 0.3);
            --danger: #ff0044;
            --bg: #050505;
            --card-bg: rgba(18, 18, 22, 0.98);
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body {
            margin: 0; padding: 0; min-height: 100vh;
            display: flex; justify-content: center; align-items: center;
            font-family: 'JetBrains Mono', monospace; color: #fff;
            background: radial-gradient(circle at center, #111111 0%, #050505 100%);
            overflow-x: hidden;
        }

        .container {
            width: 92%; max-width: 420px;
            background: var(--card-bg);
            padding: 30px 20px;
            border-radius: 20px;
            border: 1px solid rgba(255, 255, 255, 0.05);
            box-shadow: 0 40px 100px rgba(0,0,0,0.9);
            position: relative;
        }

        h1 {
            font-family: 'Orbitron'; font-size: 18px; text-align: center;
            color: var(--neon); letter-spacing: 5px; margin: 10px 0 25px 0;
            text-shadow: 0 0 10px var(--neon-glow);
        }

        /* Lang Bar */
        .lang-bar { display: flex; justify-content: center; gap: 5px; margin-bottom: 25px; }
        .lang-btn {
            flex: 1; background: #000; border: 1px solid #222;
            color: #555; padding: 8px 0; font-family: 'Orbitron'; font-size: 10px;
            border-radius: 6px; cursor: pointer; transition: 0.3s;
        }
        .lang-btn.active { color: var(--neon); border-color: var(--neon); background: rgba(0, 242, 255, 0.03); }

        /* Inputs */
        .input-box { margin-bottom: 18px; position: relative; }
        .input-label {
            font-size: 9px; color: var(--neon); text-transform: uppercase;
            margin-bottom: 6px; display: block; letter-spacing: 1px;
        }
        input[type="text"] {
            width: 100%; background: #000; border: 1px solid #1a1a1a;
            padding: 14px; color: #fff; font-size: 14px; border-radius: 10px; outline: none;
        }
        input[type="text"]:focus { border-color: var(--neon); }

        .input-wrapper { display: flex; gap: 8px; }

        /* Dropdown */
        .sound-menu-btn {
            background: #111; color: var(--neon); border: 1px solid #222;
            min-width: 50px; height: 48px; border-radius: 10px;
            font-size: 18px; cursor: pointer; display: flex; justify-content: center; align-items: center;
        }
        .sound-dropdown {
            display: none; position: absolute; top: 55px; right: 0;
            width: 100%; background: #0a0a0a; border: 1px solid var(--neon);
            border-radius: 10px; z-index: 1000; max-height: 200px; overflow-y: auto;
        }
        .sound-item { padding: 12px; border-bottom: 1px solid #111; display: flex; justify-content: space-between; font-size: 13px; cursor: pointer; }

        /* Session List (New) */
        .session-list {
            margin-top: 25px;
            max-height: 220px;
            overflow-y: auto;
            border-top: 1px solid #222;
            padding-top: 15px;
        }
        .session-item {
            background: #000; border: 1px solid #1a1a1a; padding: 12px;
            border-radius: 10px; margin-bottom: 8px; display: flex;
            justify-content: space-between; align-items: center; cursor: pointer;
            transition: 0.3s;
        }
        .session-item:hover { border-color: var(--neon); }
        .session-item span { font-size: 12px; color: #888; }
        .session-item b { color: var(--neon); font-family: 'Orbitron'; font-size: 11px; }
        .del-session { color: var(--danger); background: none; border: none; font-size: 18px; padding: 0 10px; cursor: pointer; }

        /* Buttons */
        .main-btn {
            width: 100%; padding: 16px; border: none; border-radius: 10px;
            font-family: 'Orbitron'; font-weight: 900; text-transform: uppercase;
            cursor: pointer; transition: 0.3s;
        }
        .btn-create { background: var(--neon); color: #000; }
        .btn-update { background: transparent; color: var(--neon); border: 1px solid var(--neon); margin-top: 10px; }

        .btn-scare {
            background: #0a0a0a; color: #333; height: 70px; font-size: 20px;
            margin-top: 20px; border: 1px solid #1a1a1a;
        }
        .btn-scare.ready {
            background: var(--danger); color: #fff; border: none;
            box-shadow: 0 0 30px rgba(255, 0, 68, 0.4);
        }

        #users-status { text-align: center; font-size: 11px; color: var(--neon); margin: 15px 0; }
        .link-box {
            background: #000; padding: 12px; border-radius: 8px;
            border: 1px dashed #333; margin-bottom: 20px; text-align: center;
        }
        .link-box a { color: var(--neon); text-decoration: none; font-size: 10px; }

        .btn-menu {
            background: none; color: #555; border: 1px solid #222;
            width: 100%; margin-top: 20px; padding: 10px; border-radius: 8px;
            font-family: 'Orbitron'; font-size: 10px; cursor: pointer;
        }
    </style>
</head>
<body>

<div class="container">
    <div class="lang-bar">
        <button class="lang-btn" id="lang-uk" onclick="changeLang('uk')">UA</button>
        <button class="lang-btn" id="lang-ru" onclick="changeLang('ru')">RU</button>
        <button class="lang-btn" id="lang-en" onclick="changeLang('en')">EN</button>
    </div>

    <h1 id="t-title">SYSTEM CONTROL</h1>

    <div id="setup-step">
        <div class="input-box">
            <label id="t-l-img" class="input-label">Media (Image URL)</label>
            <input type="text" id="imgUrl" value="https://prank-nfc.onrender.com/uploads/1767860423025-4268c781.jpg">
        </div>

        <div class="input-box">
            <label id="t-l-snd" class="input-label">Audio (Sound URL)</label>
            <div class="input-wrapper">
                <input type="text" id="sndUrl" value="https://www.myinstants.com/media/sounds/safonov-oplatit.mp3">
                <button class="sound-menu-btn" onclick="toggleM('create')">â˜°</button>
                <div id="drop-create" class="sound-dropdown"></div>
            </div>
        </div>

        <button class="main-btn btn-create" onclick="createLink()" id="t-btn-create">INITIALIZE SESSION</button>

        <div class="session-list" id="session-list-container">
            </div>
    </div>

    <div id="control-panel" style="display:none;">
        <div style="font-size: 10px; color: #555; margin-bottom: 5px;" id="t-managing">MANAGING: <span id="active-id-title" style="color:var(--neon)"></span></div>
        <div class="link-box"><a id="victim-link" href="#" target="_blank">LINK GENERATING...</a></div>
        
        <div class="input-box">
            <label id="t-u-title" class="input-label">Live Update:</label>
            <input type="text" id="updImgUrl" value="https://prank-nfc.onrender.com/uploads/1767860423025-4268c781.jpg" style="margin-bottom: 10px;">
            <div class="input-wrapper">
                <input type="text" id="updSndUrl" placeholder="New Sound URL">
                <button class="sound-menu-btn" onclick="toggleM('update')">â˜°</button>
                <div id="drop-update" class="sound-dropdown"></div>
            </div>
            <button class="main-btn btn-update" onclick="updateMedia()" id="t-btn-update">UPDATE LIVE</button>
        </div>

        <div id="users-status">SCANNING...</div>
        <button id="scare-btn" class="main-btn btn-scare" onclick="trigger()" disabled>SCARE ðŸ’€</button>
        <button id="bomb-btn" class="main-btn" onclick="bombardio()" style="background:none; border:1px solid var(--danger); color:var(--danger); opacity:0.3;" disabled>â˜¢ BOMBARDIO</button>

        <button class="btn-menu" id="t-btn-menu" onclick="showMenu()">[ MENU ]</button>
    </div>
</div>

<audio id="p-audio"></audio>

<script src="/socket.io/socket.io.js"></script>
<script>
    const socket = io();
    let currentRoom = null;
    let sessions = JSON.parse(localStorage.getItem('spy_sessions') || "[]");

    const sounds = [
        { n: "ÐžÐ¿Ð»Ð°Ñ‚Ð¸Ñ‚ÑŒ!", u: "https://www.myinstants.com/media/sounds/safonov-oplatit.mp3" },
        { n: "Ð§ÑƒÐ³ÑƒÐ½", u: "https://www.myinstants.com/media/sounds/chugun.mp3" },
        { n: "Ð”ÐŸÐ¡ ÐšÑ€ÑÐº", u: "https://www.myinstants.com/media/sounds/kriakalka-dps-no-2.mp3" },
        { n: "Ð¡ÐºÑ€Ð¸Ð¼ÐµÑ€", u: "https://www.myinstants.com/media/sounds/scream_horror1.mp3" },
        { n: "Ð¡Ñ‚Ð¾Ð½Ñ‹", u: "https://www.myinstants.com/media/sounds/shkola.mp3" },
        { n: "ÐŸÐµÑ€Ð´ÐµÐ¶", u: "https://www.myinstants.com/media/sounds/perdezh-700.mp3" }
    ];

    const translations = {
        uk: { t: "SYSTEM CONTROL", c: "Ð¡Ð¢Ð’ÐžÐ Ð˜Ð¢Ð˜ Ð¡Ð•Ð¡Ð†Ð®", img: "Ð—ÐžÐ‘Ð ÐÐ–Ð•ÐÐÐ¯ (URL)", snd: "Ð—Ð’Ð£Ðš (URL)", u: "ÐžÐÐžÐ’Ð˜Ð¢Ð˜", ut: "LIVE ÐžÐÐžÐ’Ð›Ð•ÐÐÐ¯:", m: "ÐšÐ•Ð Ð£Ð’ÐÐÐÐ¯:", menu: "[ ÐœÐ•ÐÐ® ]", wait: "ÐžÐ§Ð†ÐšÐ£Ð’ÐÐÐÐ¯..." },
        ru: { t: "SYSTEM CONTROL", c: "Ð¡ÐžÐ—Ð”ÐÐ¢Ð¬ Ð¡Ð•Ð¡Ð¡Ð˜Ð®", img: "Ð˜Ð—ÐžÐ‘Ð ÐÐ–Ð•ÐÐ˜Ð• (URL)", snd: "Ð—Ð’Ð£Ðš (URL)", u: "ÐžÐ‘ÐÐžÐ’Ð˜Ð¢Ð¬", ut: "LIVE ÐžÐ‘ÐÐžÐ’Ð›Ð•ÐÐ˜Ð•:", m: "Ð£ÐŸÐ ÐÐ’Ð›Ð•ÐÐ˜Ð•:", menu: "[ ÐœÐ•ÐÐ® ]", wait: "ÐžÐ–Ð˜Ð”ÐÐÐ˜Ð•..." },
        en: { t: "SYSTEM CONTROL", c: "INITIALIZE SESSION", img: "IMAGE URL", snd: "SOUND URL", u: "UPDATE", ut: "LIVE UPDATE:", m: "MANAGING:", menu: "[ MENU ]", wait: "SCANNING..." }
    };

    function changeLang(l) {
        localStorage.setItem('spy_lang', l);
        document.querySelectorAll('.lang-btn').forEach(b => b.classList.remove('active'));
        document.getElementById('lang-' + l).classList.add('active');
        const d = translations[l];
        document.getElementById('t-title').innerText = d.t;
        document.getElementById('t-btn-create').innerText = d.c;
        document.getElementById('t-l-img').innerText = d.img;
        document.getElementById('t-l-snd').innerText = d.snd;
        document.getElementById('t-btn-update').innerText = d.u;
        document.getElementById('t-u-title').innerText = d.ut;
        document.getElementById('t-managing').innerHTML = `${d.m} <span id="active-id-title" style="color:var(--neon)">${currentRoom || ''}</span>`;
        document.getElementById('t-btn-menu').innerText = d.menu;
    }

    function renderSessions() {
        const container = document.getElementById('session-list-container');
        container.innerHTML = sessions.length ? '' : '<div style="color:#444; text-align:center; font-size:10px; margin-top:20px;">NO ACTIVE SESSIONS</div>';
        sessions.forEach((id, index) => {
            const div = document.createElement('div');
            div.className = 'session-item';
            div.innerHTML = `
                <div onclick="selectSession('${id}')">
                    <span>${index + 1}. </span><b>${id}</b>
                </div>
                <button class="del-session" onclick="deleteSession('${id}', event)">âœ•</button>
            `;
            container.appendChild(div);
        });
    }

    async function createLink() {
        const res = await fetch('/create', {
            method: 'POST', headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({ image: document.getElementById('imgUrl').value, sound: document.getElementById('sndUrl').value })
        });
        const data = await res.json();
        sessions.push(data.id);
        localStorage.setItem('spy_sessions', JSON.stringify(sessions));
        selectSession(data.id);
    }

    function selectSession(id) {
        currentRoom = id;
        document.getElementById('setup-step').style.display = 'none';
        document.getElementById('control-panel').style.display = 'block';
        document.getElementById('active-id-title').innerText = id;
        const link = `${window.location.origin}/victim.html?id=${id}`;
        document.getElementById('victim-link').href = link;
        document.getElementById('victim-link').innerText = link;
        socket.emit('join-room-admin', id);
        changeLang(localStorage.getItem('spy_lang') || 'en');
    }

    function deleteSession(id, e) {
        e.stopPropagation();
        if(confirm("Delete " + id + "?")) {
            sessions = sessions.filter(s => s !== id);
            localStorage.setItem('spy_sessions', JSON.stringify(sessions));
            renderSessions();
        }
    }

    function showMenu() {
        document.getElementById('control-panel').style.display = 'none';
        document.getElementById('setup-step').style.display = 'block';
        renderSessions();
    }

    function renderSounds() {
        ['create', 'update'].forEach(mode => {
            const box = document.getElementById(`drop-${mode}`);
            const targetInput = mode === 'create' ? 'sndUrl' : 'updSndUrl';
            box.innerHTML = sounds.map(s => `
                <div class="sound-item" onclick="pick('${targetInput}', '${s.u}', 'drop-${mode}')">
                    <span>${s.n}</span>
                    <span style="color:var(--neon)" onclick="playSnd('${s.u}', event)">â–¶</span>
                </div>
            `).join('');
        });
    }

    function pick(input, url, drop) {
        document.getElementById(input).value = url;
        document.getElementById(drop).style.display = 'none';
    }

    function playSnd(url, e) {
        e.stopPropagation();
        const a = document.getElementById('p-audio');
        a.src = url; a.play();
    }

    function toggleM(id) {
        const el = document.getElementById(`drop-${id}`);
        const v = el.style.display === 'block';
        document.querySelectorAll('.sound-dropdown').forEach(d => d.style.display = 'none');
        el.style.display = v ? 'none' : 'block';
    }

    async function updateMedia() {
        await fetch(`/update-session/${currentRoom}`, {
            method: 'POST', headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({ image: document.getElementById('updImgUrl').value, sound: document.getElementById('updSndUrl').value })
        });
        alert("UPDATED");
    }

    function trigger() { socket.emit('trigger-scare', currentRoom); }
    function bombardio() { socket.emit('trigger-redirect', { roomId: currentRoom, url: "https://prank-nfc.onrender.com/volumeshader_bm.html" }); }

    socket.on('update-victim-list', (u) => {
        const s = document.getElementById('scare-btn');
        const b = document.getElementById('bomb-btn');
        const status = document.getElementById('users-status');
        if (u.length > 0) {
            s.disabled = false; s.classList.add('ready');
            b.disabled = false; b.style.opacity = "1";
            status.innerHTML = `TARGETS: ${u.length}`;
        } else {
            s.disabled = true; s.classList.remove('ready');
            b.disabled = true; b.style.opacity = "0.3";
            status.innerText = translations[localStorage.getItem('spy_lang') || 'en'].wait;
        }
    });

    window.onload = () => {
        changeLang(localStorage.getItem('spy_lang') || 'uk');
        renderSessions();
        renderSounds();
    };

    window.onclick = (e) => {
        if (!e.target.closest('.sound-menu-btn')) document.querySelectorAll('.sound-dropdown').forEach(d => d.style.display = 'none');
    };
</script>
</body>
</html>
