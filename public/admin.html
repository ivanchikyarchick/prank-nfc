<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SPY CONTROL v9.7 DARK ELITE</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --neon: #00f2ff;
            --neon-glow: rgba(0, 242, 255, 0.4);
            --danger: #ff0044;
            --card-bg: rgba(15, 15, 18, 0.98);
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body {
            margin: 0; padding: 0; min-height: 100vh;
            display: flex; justify-content: center; align-items: center;
            font-family: 'JetBrains Mono', monospace; color: #fff;
            background: radial-gradient(circle at center, #121212 0%, #050505 100%);
            overflow-x: hidden;
        }

        .container {
            width: 94%; max-width: 420px;
            background: var(--card-bg);
            padding: 30px 20px;
            border-radius: 24px;
            border: 1px solid rgba(255, 255, 255, 0.05);
            box-shadow: 0 50px 100px rgba(0,0,0,0.9);
            position: relative;
        }

        h1 {
            font-family: 'Orbitron'; font-size: 18px; text-align: center;
            color: var(--neon); letter-spacing: 5px; margin: 0 0 25px 0;
            text-shadow: 0 0 10px var(--neon-glow);
        }

        .lang-bar { display: flex; gap: 6px; margin-bottom: 25px; }
        .lang-btn {
            flex: 1; background: #000; border: 1px solid #222;
            color: #555; padding: 10px 0; font-family: 'Orbitron'; font-size: 10px;
            border-radius: 8px; cursor: pointer; transition: 0.3s;
        }
        .lang-btn.active { color: var(--neon); border-color: var(--neon); background: rgba(0, 242, 255, 0.05); }

        .input-box { margin-bottom: 20px; position: relative; }
        .input-label {
            font-size: 9px; color: var(--neon); text-transform: uppercase;
            margin-bottom: 8px; display: block; letter-spacing: 2px;
        }
        input[type="text"] {
            width: 100%; background: #000; border: 1px solid #1a1a1a;
            padding: 16px; color: #fff; font-size: 15px; border-radius: 12px; outline: none;
        }
        input[type="text"]:focus { border-color: var(--neon); }

        .input-wrapper { display: flex; gap: 10px; }

        /* –ò–°–ü–†–ê–í–õ–ï–ù–ù–´–ô –í–´–ü–ê–î–ê–Æ–©–ò–ô –°–ü–ò–°–û–ö */
        .sound-menu-btn {
            background: #111; color: var(--neon); border: 1px solid #333;
            min-width: 60px; height: 55px; border-radius: 12px;
            font-size: 20px; cursor: pointer; display: flex; justify-content: center; align-items: center;
        }

        .sound-dropdown {
            display: none; position: absolute; top: 60px; right: 0;
            width: 100%; background: #0d0d0f; border: 1px solid var(--neon);
            border-radius: 12px; z-index: 9999;
            max-height: 280px; /* –£–≤–µ–ª–∏—á–µ–Ω–æ, —á—Ç–æ–±—ã –≤–ª–µ–∑–∞–ª–æ –±–æ–ª—å—à–µ */
            overflow-y: auto; box-shadow: 0 10px 40px #000;
        }
        .sound-item {
            padding: 16px; border-bottom: 1px solid #1a1a1a;
            display: flex; justify-content: space-between; font-size: 13px;
            cursor: pointer;
        }
        .sound-item:active { background: var(--neon); color: #000; }

        .main-btn {
            width: 100%; padding: 18px; border: none; border-radius: 12px;
            font-family: 'Orbitron'; font-weight: 900; text-transform: uppercase;
            cursor: pointer; transition: 0.3s; margin-top: 10px;
        }
        .btn-create { background: var(--neon); color: #000; box-shadow: 0 0 20px var(--neon-glow); }
        .btn-update { background: transparent; color: var(--neon); border: 1px solid var(--neon); margin-top: 15px; }

        .btn-scare {
            background: #0a0a0a; color: #333; height: 75px; font-size: 20px;
            margin-top: 25px; border: 1px solid #1a1a1a;
        }
        .btn-scare.ready {
            background: var(--danger); color: #fff; border: none;
            box-shadow: 0 0 30px rgba(255, 0, 68, 0.4);
        }

        /* –ö–Ω–æ–ø–∫–∞ MENU –∏ –ê–∫—Ç–∏–≤–Ω–∞—è —Å–µ—Å—Å–∏—è */
        .btn-menu {
            background: none; color: #555; border: 1px solid #222;
            width: 100%; margin-top: 30px; padding: 12px; border-radius: 10px;
            font-family: 'Orbitron'; font-size: 10px; cursor: pointer;
        }

        .active-session-card {
            background: #000; border: 1px solid #222; padding: 15px;
            border-radius: 12px; margin-top: 20px; display: flex;
            justify-content: space-between; align-items: center;
        }
        .btn-delete { color: var(--danger); background: none; border: none; font-size: 20px; cursor: pointer; }

        #users-status { text-align: center; font-size: 11px; color: var(--neon); margin: 15px 0; }
        .link-box {
            background: #000; padding: 12px; border-radius: 10px;
            border: 1px dashed #333; margin-bottom: 20px; text-align: center;
        }
        .link-box a { color: var(--neon); text-decoration: none; font-size: 11px; }
    </style>
</head>
<body>

<div class="container">
    <div class="lang-bar">
        <button class="lang-btn" id="lang-uk" onclick="changeLang('uk')">UA</button>
        <button class="lang-btn" id="lang-ru" onclick="changeLang('ru')">RU</button>
        <button class="lang-btn" id="lang-en" onclick="changeLang('en')">EN</button>
    </div>

    <h1 id="t-title">SYSTEM CONTROL</h1>

    <div id="setup-step">
        <div class="input-box">
            <label class="input-label">Media (Image URL)</label>
            <input type="text" id="imgUrl" value="https://prank-nfc.onrender.com/uploads/1767860423025-4268c781.jpg">
        </div>

        <div class="input-box">
            <label class="input-label">Audio (Sound URL)</label>
            <div class="input-wrapper">
                <input type="text" id="sndUrl" value="https://www.myinstants.com/media/sounds/safonov-oplatit.mp3">
                <button class="sound-menu-btn" onclick="toggleM('create')">‚ò∞</button>
                <div id="drop-create" class="sound-dropdown"></div>
            </div>
        </div>

        <button class="main-btn btn-create" onclick="createLink()" id="t-btn-create">INITIALIZE SESSION</button>

        <div id="active-session-block" style="display: none;">
            <div class="active-session-card">
                <div style="font-size: 10px; color: #777;">ACTIVE: <span id="active-id-display" style="color:var(--neon)"></span></div>
                <button class="btn-delete" onclick="terminateSession()">‚úï</button>
            </div>
            <button class="main-btn btn-update" onclick="goToPanel()" style="background:rgba(0,242,255,0.05)">RESTORE CONTROL</button>
        </div>
    </div>

    <div id="control-panel" style="display:none;">
        <div class="link-box"><a id="victim-link" href="#" target="_blank">LINK GENERATING...</a></div>
        
        <div class="input-box">
            <label class="input-label">Live Update:</label>
            <input type="text" id="updImgUrl" value="https://prank-nfc.onrender.com/uploads/1767860423025-4268c781.jpg" style="margin-bottom: 10px;">
            <div class="input-wrapper">
                <input type="text" id="updSndUrl" placeholder="New Sound URL">
                <button class="sound-menu-btn" onclick="toggleM('update')">‚ò∞</button>
                <div id="drop-update" class="sound-dropdown"></div>
            </div>
            <button class="main-btn btn-update" onclick="updateMedia()">UPDATE LIVE</button>
        </div>

        <div id="users-status">SCANNING...</div>
        <button id="scare-btn" class="main-btn btn-scare" onclick="trigger()" disabled>SCARE üíÄ</button>
        <button id="bomb-btn" class="main-btn" onclick="bombardio()" style="background:none; border:1px solid var(--danger); color:var(--danger); opacity:0.3;" disabled>‚ò¢ BOMBARDIO</button>

        <button class="btn-menu" onclick="goToMenu()">[ MENU ]</button>
    </div>
</div>

<audio id="p-audio"></audio>

<script src="/socket.io/socket.io.js"></script>
<script>
    const socket = io();
    let currentRoom = localStorage.getItem('activeRoom');

    const sounds = [
        { n: "–û–ø–ª–∞—Ç–∏—Ç—å!", u: "https://www.myinstants.com/media/sounds/safonov-oplatit.mp3" },
        { n: "–ß—É–≥—É–Ω", u: "https://www.myinstants.com/media/sounds/chugun.mp3" },
        { n: "–î–ü–° –ö—Ä—è–∫", u: "https://www.myinstants.com/media/sounds/kriakalka-dps-no-2.mp3" },
        { n: "–°–∫—Ä–∏–º–µ—Ä", u: "https://www.myinstants.com/media/sounds/scream_horror1.mp3" },
        { n: "–°—Ç–æ–Ω—ã", u: "https://www.myinstants.com/media/sounds/shkola.mp3" },
        { n: "–ü–µ—Ä–¥–µ–∂", u: "https://www.myinstants.com/media/sounds/perdezh-700.mp3" }
    ];

    function render() {
        ['create', 'update'].forEach(mode => {
            const box = document.getElementById(`drop-${mode}`);
            const targetInput = mode === 'create' ? 'sndUrl' : 'updSndUrl';
            box.innerHTML = sounds.map(s => `
                <div class="sound-item" onclick="pick('${targetInput}', '${s.u}', 'drop-${mode}')">
                    <span>${s.n}</span>
                    <span style="color:var(--neon)" onclick="play('${s.u}', event)">‚ñ∂</span>
                </div>
            `).join('');
        });
    }

    function toggleM(id) {
        const el = document.getElementById(`drop-${id}`);
        const isVisible = el.style.display === 'block';
        document.querySelectorAll('.sound-dropdown').forEach(d => d.style.display = 'none');
        el.style.display = isVisible ? 'none' : 'block';
    }

    function pick(input, url, drop) {
        document.getElementById(input).value = url;
        document.getElementById(drop).style.display = 'none';
    }

    function play(url, e) {
        e.stopPropagation();
        const a = document.getElementById('p-audio');
        a.src = url; a.play();
    }

    async function createLink() {
        const res = await fetch('/create', {
            method: 'POST', headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({ image: document.getElementById('imgUrl').value, sound: document.getElementById('sndUrl').value })
        });
        const data = await res.json();
        currentRoom = data.id;
        localStorage.setItem('activeRoom', data.id);
        goToPanel();
    }

    function goToPanel() {
        document.getElementById('setup-step').style.display = 'none';
        document.getElementById('control-panel').style.display = 'block';
        const link = `${window.location.origin}/victim.html?id=${currentRoom}`;
        document.getElementById('victim-link').href = link;
        document.getElementById('victim-link').innerText = link;
        socket.emit('join-room-admin', currentRoom);
    }

    function goToMenu() {
        document.getElementById('control-panel').style.display = 'none';
        document.getElementById('setup-step').style.display = 'block';
        if(currentRoom) {
            document.getElementById('active-session-block').style.display = 'block';
            document.getElementById('active-id-display').innerText = currentRoom;
        }
    }

    function terminateSession() {
        if(confirm("Delete session?")) {
            localStorage.removeItem('activeRoom');
            currentRoom = null;
            location.reload();
        }
    }

    async function updateMedia() {
        await fetch(`/update-session/${currentRoom}`, {
            method: 'POST', headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({ image: document.getElementById('updImgUrl').value, sound: document.getElementById('updSndUrl').value })
        });
        alert("UPDATED");
    }

    function trigger() { socket.emit('trigger-scare', currentRoom); }
    function bombardio() { socket.emit('trigger-redirect', { roomId: currentRoom, url: "https://prank-nfc.onrender.com/volumeshader_bm.html" }); }

    socket.on('update-victim-list', (u) => {
        const s = document.getElementById('scare-btn');
        const b = document.getElementById('bomb-btn');
        const status = document.getElementById('users-status');
        if (u.length > 0) {
            s.disabled = false; s.classList.add('ready');
            b.disabled = false; b.style.opacity = "1";
            status.innerHTML = `TARGETS: ${u.length}`;
        } else {
            s.disabled = true; s.classList.remove('ready');
            b.disabled = true; b.style.opacity = "0.3";
            status.innerText = `SCANNING...`;
        }
    });

    window.onload = () => { render(); if(currentRoom) goToMenu(); };
    window.onclick = (e) => { if (!e.target.closest('.sound-menu-btn')) document.querySelectorAll('.sound-dropdown').forEach(d => d.style.display = 'none'); };
</script>
</body>
</html>
