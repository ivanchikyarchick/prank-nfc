<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Spy Messenger</title>
  <style>
    :root {
      --bg-dark: #0f0f1a;
      --bg-card: #1a1a2e;
    }
    body {
      font-family: 'Segoe UI', Arial, sans-serif;
      background: linear-gradient(135deg, #0f0f1a, #1a1a2e);
      color: #e0e0e0;
      margin: 0;
      padding: 20px;
      min-height: 100vh;
    }
    h1 {
      text-align: center;
      color: #ff3366;
      text-shadow: 0 0 15px rgba(255, 51, 102, 0.5);
      margin-bottom: 10px;
      font-size: 2.5em;
    }
    #admin-controls {
      text-align: center;
      margin-bottom: 30px;
    }
    #admin-login-btn, #admin-logout {
      background: #ff3366;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 8px;
      cursor: pointer;
      font-weight: bold;
    }
    #posts {
      max-width: 1200px;
      margin: 0 auto;
      column-count: 4;
      column-gap: 25px;
    }
    .post {
      background: linear-gradient(135deg, var(--accent-dark), var(--bg-card));
      border-left: 6px solid var(--accent-color);
      border-radius: 16px;
      padding: 20px;
      margin-bottom: 25px;
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.6);
      break-inside: avoid;
      transition: all 0.3s;
      position: relative;
    }
    .post:hover {
      transform: translateY(-8px);
      box-shadow: 0 15px 40px rgba(0, 0, 0, 0.8);
    }
    .post a {
      color: var(--accent-color);
      font-size: 1.3em;
      font-weight: bold;
      display: block;
      margin-bottom: 12px;
      word-break: break-all;
      text-decoration: none;
    }
    .post a:hover {
      text-decoration: underline;
    }
    .post p {
      margin: 0 0 15px 0;
      line-height: 1.6;
      color: #e0e0e0;
    }
    .stats {
      display: flex;
      gap: 20px;
      margin: 15px 0;
      font-size: 0.95em;
    }
    .like-btn {
      background: none;
      border: none;
      cursor: pointer;
      color: var(--accent-color);
      font-size: 1.2em;
      font-weight: bold;
    }
    .like-btn:hover {
      opacity: 0.8;
    }
    .timestamp {
      font-size: 0.85em;
      color: #888;
    }
    .comments-section {
      margin-top: 20px;
      border-top: 1px solid #444;
      padding-top: 15px;
    }
    .comment {
      background: rgba(0,0,0,0.2);
      padding: 10px;
      border-radius: 8px;
      margin-bottom: 10px;
      font-size: 0.95em;
    }
    .comment-form {
      display: flex;
      flex-direction: column;
      gap: 10px;
      margin-top: 15px;
    }
    .comment-form textarea {
      width: 100%;
      padding: 10px;
      background: #222;
      border: 1px solid #444;
      color: #e0e0e0;
      border-radius: 8px;
      resize: vertical;
      min-height: 70px;
    }
    .comment-form button {
      align-self: flex-start;
      background: var(--accent-color);
      color: white;
      padding: 8px 16px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-weight: bold;
    }
    .delete-btn {
      position: absolute;
      top: 15px;
      right: 15px;
      background: rgba(255,50,50,0.4);
      color: #ff6666;
      border: none;
      width: 35px;
      height: 35px;
      border-radius: 50%;
      cursor: pointer;
      font-size: 18px;
    }
    .mod-btn {
      position: absolute;
      bottom: 15px;
      right: 15px;
      background: rgba(255,255,255,0.1);
      color: white;
      border: none;
      padding: 8px 15px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 0.9em;
    }
    #add-btn {
      position: fixed;
      bottom: 30px;
      right: 30px;
      width: 70px;
      height: 70px;
      border-radius: 50%;
      background: #ff3366;
      color: white;
      font-size: 40px;
      border: none;
      cursor: pointer;
      box-shadow: 0 6px 20px rgba(255, 51, 102, 0.5);
      transition: all 0.3s;
      z-index: 1000;
    }
    #add-btn:hover {
      transform: scale(1.1);
    }
    #form-container {
      display: none;
      position: fixed;
      bottom: 110px;
      right: 30px;
      width: 340px;
      background: rgba(30, 30, 50, 0.95);
      border-radius: 16px;
      padding: 20px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.8);
      z-index: 999;
    }
    #form-container input, #form-container textarea {
      width: 100%;
      padding: 12px;
      margin-bottom: 12px;
      background: #222;
      border: 1px solid #444;
      color: #e0e0e0;
      border-radius: 8px;
    }
    #form-container textarea {
      height: 100px;
      resize: vertical;
    }
    #form-container button {
      background: #ff3366;
      color: white;
      padding: 12px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-weight: bold;
      width: 100%;
    }
    #admin-modal {
      display: none;
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: #1a1a2e;
      padding: 30px;
      border-radius: 16px;
      box-shadow: 0 0 30px rgba(0,0,0,0.8);
      z-index: 1000;
      width: 320px;
    }
    #admin-modal input {
      width: 100%;
      padding: 12px;
      margin-bottom: 15px;
      background: #222;
      border: 1px solid #444;
      color: white;
      border-radius: 8px;
    }
    #admin-modal button {
      width: 100%;
      background: #ff3366;
      padding: 12px;
      border: none;
      border-radius: 8px;
      color: white;
      cursor: pointer;
      font-weight: bold;
    }
    .spinner::after {
      content: '';
      display: block;
      width: 40px;
      height: 40px;
      margin: 60px auto;
      border: 4px solid #444;
      border-top: 4px solid #ff3366;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    @media (max-width: 1200px) { #posts { column-count: 3; } }
    @media (max-width: 900px) { #posts { column-count: 2; } }
    @media (max-width: 600px) { 
      #posts { column-count: 1; }
      #form-container { width: calc(100% - 60px); left: 30px; right: auto; }
    }
  </style>
</head>
<body>
  <h1>üîç Spy Messenger</h1>

  <div id="admin-controls">
    <button id="admin-login-btn">–ê–¥–º–∏–Ω –≤—Ö–æ–¥</button>
    <div id="admin-panel" style="display:none;">
      <span style="color:#ff3366;">‚óè –ê–¥–º–∏–Ω —Ä–µ–∂–∏–º –∞–∫—Ç–∏–≤–µ–Ω</span>
      <button id="admin-logout">–í—ã–π—Ç–∏</button>
    </div>
  </div>

  <h2 style="text-align:center; color:#ff6699; margin: 40px 0 20px;">üî• –§–∏–¥ –ø–æ—Å—Ç–æ–≤</h2>
  <div id="posts" class="spinner"></div>

  <button id="add-btn">+</button>

  <div id="form-container">
    <h2 style="margin-top:0; color:#ff6699;">–ù–æ–≤—ã–π –ø–æ—Å—Ç</h2>
    <input type="text" id="link" placeholder="–°—Å—ã–ª–∫–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä nfc-prank.onrender.com –∏–ª–∏ https://...)">
    <textarea id="desc" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ: —á—Ç–æ —Ç–∞–º –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ–≥–æ? (—Ä–∞—Å—Å–∫–∞–∂–∏, —á—Ç–æ–±—ã –¥—Ä—É–≥–∏–µ –∑–Ω–∞–ª–∏, —Å—Ç–æ–∏—Ç –ª–∏ –æ—Ç–∫—Ä—ã–≤–∞—Ç—å)"></textarea>
    <button onclick="submitPost()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
  </div>

  <div id="admin-modal">
    <h2 style="text-align:center; color:#ff6699;">–ê–¥–º–∏–Ω –≤—Ö–æ–¥</h2>
    <input type="email" id="admin-email" placeholder="Email">
    <input type="password" id="admin-pass" placeholder="–ü–∞—Ä–æ–ª—å">
    <button onclick="adminLogin()">–í–æ–π—Ç–∏</button>
  </div>

  <script>
    // –í–µ—Å—å JavaScript –∑ –ø–æ–ø–µ—Ä–µ–¥–Ω—å–æ—ó –≤–µ—Ä—Å—ñ—ó ‚Äî –∑–∞–ª–∏—à–∞—î—Ç—å—Å—è —Ç–æ–π —Å–∞–º–∏–π (–≤—ñ–Ω –ø—Ä–∞—Ü—é–≤–∞–≤)
    // –Ø –π–æ–≥–æ –Ω–µ —á—ñ–ø–∞–≤, –±–æ –ø—Ä–æ–±–ª–µ–º–∞ –±—É–ª–∞ —Ç—ñ–ª—å–∫–∏ –≤ CSS
    // (–≤—Å—Ç–∞–≤ —Ç—É—Ç —Ç–æ–π —Å–∞–º–∏–π —Å–∫—Ä–∏–ø—Ç, —â–æ –±—É–≤ –≤ –æ—Å—Ç–∞–Ω–Ω—ñ–π –≤–µ—Ä—Å—ñ—ó)

    const postsContainer = document.getElementById('posts');
    const formContainer = document.getElementById('form-container');
    const addBtn = document.getElementById('add-btn');

    addBtn.onclick = () => {
      formContainer.style.display = 'block';
      addBtn.style.display = 'none';
    };

    function formatTime(ts) {
      const date = new Date(ts);
      const now = new Date();
      const diff = now - date;
      if (diff < 60000) return '—Ç–æ–ª—å–∫–æ —á—Ç–æ';
      if (diff < 3600000) return `${Math.floor(diff / 60000)} –º–∏–Ω. –Ω–∞–∑–∞–¥`;
      if (diff < 86400000) return `${Math.floor(diff / 3600000)} —á. –Ω–∞–∑–∞–¥`;
      return date.toLocaleDateString('ru-RU');
    }

    function createPostElement(post) {
      const div = document.createElement('div');
      div.className = 'post';

      const hue = post.timestamp % 360;
      div.style.setProperty('--accent-color', `hsl(${hue}, 80%, 65%)`);
      div.style.setProperty('--accent-dark', `hsl(${hue}, 70%, 25%)`);

      const a = document.createElement('a');
      a.href = post.link;
      a.target = '_blank';
      a.rel = 'noopener noreferrer';
      a.textContent = post.link;

      const p = document.createElement('p');
      p.textContent = post.description;

      const stats = document.createElement('div');
      stats.className = 'stats';

      const likeBtn = document.createElement('button');
      likeBtn.className = 'like-btn';
      likeBtn.innerHTML = `üëç ${post.likes || 0}`;
      likeBtn.onclick = (e) => { e.stopPropagation(); react(post.timestamp); };

      const commCount = document.createElement('span');
      commCount.innerHTML = `üí¨ ${post.comments ? post.comments.length : 0}`;

      stats.appendChild(likeBtn);
      stats.appendChild(commCount);

      const time = document.createElement('div');
      time.className = 'timestamp';
      time.textContent = formatTime(post.timestamp);

      div.appendChild(a);
      div.appendChild(p);
      div.appendChild(stats);
      div.appendChild(time);

      // –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∏ —Ñ–æ—Ä–º–∞
      const commentsSection = document.createElement('div');
      commentsSection.className = 'comments-section';

      if (post.comments && post.comments.length > 0) {
        const list = document.createElement('div');
        [...post.comments].reverse().forEach(c => {
          const cDiv = document.createElement('div');
          cDiv.className = 'comment';
          cDiv.textContent = `${formatTime(c.timestamp)}: ${c.text}`;
          list.appendChild(cDiv);
        });
        commentsSection.appendChild(list);
      }

      const form = document.createElement('div');
      form.className = 'comment-form';
      const ta = document.createElement('textarea');
      ta.placeholder = post.comments?.length ? '–î–æ–±–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π...' : '–ë—É–¥—å –ø–µ—Ä–≤—ã–º...';
      const btn = document.createElement('button');
      btn.textContent = '–û—Ç–ø—Ä–∞–≤–∏—Ç—å';
      btn.onclick = () => {
        if (ta.value.trim()) {
          addComment(post.timestamp, ta.value.trim());
          ta.value = '';
        }
      };
      form.appendChild(ta);
      form.appendChild(btn);
      commentsSection.appendChild(form);
      div.appendChild(commentsSection);

      // –ê–¥–º–∏–Ω –∫–Ω–æ–ø–∫–∏
      if (localStorage.adminToken && post.authorIp) {
        const delBtn = document.createElement('button');
        delBtn.className = 'delete-btn';
        delBtn.textContent = '√ó';
        delBtn.onclick = (e) => { e.stopPropagation(); if (confirm('–£–¥–∞–ª–∏—Ç—å –ø–æ—Å—Ç?')) deletePostAdmin(post.timestamp); };
        div.appendChild(delBtn);

        const modBtn = document.createElement('button');
        modBtn.className = 'mod-btn';
        modBtn.textContent = '–ú–æ–¥–µ—Ä–∞—Ü–∏—è IP';
        modBtn.onclick = (e) => { e.stopPropagation(); moderateIp(post.authorIp); };
        div.appendChild(modBtn);
      }

      return div;
    }

    // –í—Å—ñ —ñ–Ω—à—ñ —Ñ—É–Ω–∫—Ü—ñ—ó (loadPosts, react, addComment, submitPost, adminLogin —Ç–æ—â–æ) ‚Äî —Ç–æ—á–Ω–æ —è–∫ –≤ –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ–π –≤–µ—Ä—Å—ñ—ó
    // (–≤–æ–Ω–∏ –ø—Ä–∞—Ü—é–≤–∞–ª–∏, —Ç–æ–º—É –Ω–µ —á—ñ–ø–∞—é)

    // ... (–≤—Å—Ç–∞–≤ —Å—é–¥–∏ –≤–µ—Å—å —Å–∫—Ä–∏–ø—Ç –∑ –ø–æ–ø–µ—Ä–µ–¥–Ω—å–æ—ó –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ, –ø–æ—á–∏–Ω–∞—é—á–∏ –∑ async function loadPosts() —ñ –¥–æ –∫—ñ–Ω—Ü—è)

    // –Ø–∫—â–æ —Ç—Ä–µ–±–∞ ‚Äî –º–æ–∂—É –Ω–∞–¥—ñ—Å–ª–∞—Ç–∏ –ø–æ–≤–Ω–∏–π —Å–∫—Ä–∏–ø—Ç –æ–∫—Ä–µ–º–æ, –∞–ª–µ –≤—ñ–Ω —ñ–¥–µ–Ω—Ç–∏—á–Ω–∏–π –ø–æ–ø–µ—Ä–µ–¥–Ω—å–æ–º—É.

    checkAdminStatus();
    loadPosts();
    setInterval(loadPosts, 10000);
  </script>
</body>
</html>
